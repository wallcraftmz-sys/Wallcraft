<!DOCTYPE html>
<html lang="{{ lang }}">
<head>
    <meta charset="UTF-8">
    <title>Wallcraft</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script defer src="{{ url_for('static', filename='js/main.js') }}"></script>
</head>
<body>

<header class="top-header">
    <button class="menu-btn" onclick="toggleUserMenu()">â˜°</button>

    <div class="logo-center">
        <a href="{{ url_for('index') }}" class="logo-link">
            <span class="logo-text">Wallcraft</span>
        </a>
    </div>

    <div class="lang-switch">
        <a href="?lang=ru" class="{{ 'active' if lang == 'ru' }}">RU</a> |
        <a href="?lang=lv" class="{{ 'active' if lang == 'lv' }}">LV</a> |
        <a href="?lang=en" class="{{ 'active' if lang == 'en' }}">EN</a>
    </div>
</header>

<div id="userMenuOverlay" class="menu-overlay" onclick="closeUserMenu()"></div>

<div id="userSideMenu" class="side-menu">
    <a href="{{ url_for('catalog') }}" onclick="closeUserMenu()">ğŸ›ï¸ ĞšĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³</a>
    <a href="{{ url_for('cart') }}" onclick="closeUserMenu()">ğŸ›’ ĞšĞ¾Ñ€Ğ·Ğ¸Ğ½Ğ°</a>

    {% if current_user.is_authenticated %}
        <a href="{{ url_for('profile') }}" onclick="closeUserMenu()">ğŸ‘¤ ĞŸÑ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ</a>
        {% if current_user.role == "admin" %}
            <a href="{{ url_for('admin_panel') }}" onclick="closeUserMenu()">ğŸ§° ĞĞ´Ğ¼Ğ¸Ğ½ĞºĞ°</a>
        {% endif %}
        <hr>
        <a href="{{ url_for('logout') }}" onclick="closeUserMenu()">ğŸšª Ğ’Ñ‹Ğ¹Ñ‚Ğ¸</a>
    {% else %}
        <hr>
        <a href="{{ url_for('login') }}" onclick="closeUserMenu()">ğŸ”‘ Ğ’Ğ¾Ğ¹Ñ‚Ğ¸</a>
        <a href="{{ url_for('register') }}" onclick="closeUserMenu()">ğŸ“ Ğ ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ</a>
    {% endif %}
</div>

<main class="container">
    {% block content %}{% endblock %}
</main>

<script>
function toggleUserMenu() {
    const menu = document.getElementById("userSideMenu");
    const overlay = document.getElementById("userMenuOverlay");
    if (!menu || !overlay) return;
    menu.classList.toggle("open");
    overlay.classList.toggle("show");
}
function closeUserMenu() {
    const menu = document.getElementById("userSideMenu");
    const overlay = document.getElementById("userMenuOverlay");
    if (menu) menu.classList.remove("open");
    if (overlay) overlay.classList.remove("show");
}
</script>

<!-- FLOATING CART (User) -->
<a href="{{ url_for('cart') }}" class="cart-fab" aria-label="ĞšĞ¾Ñ€Ğ·Ğ¸Ğ½Ğ°">
  <span class="cart-fab-ico">ğŸ›’</span>
  <span id="cart-count" class="cart-badge">0</span>
</a>

<script>
async function refreshCartCount() {
  try {
    const res = await fetch("/api/cart_count", { credentials: "same-origin" });
    const ct = res.headers.get("content-type") || "";
    if (!ct.includes("application/json")) return;
    const data = await res.json();
    const badge = document.getElementById("cart-count");
    if (badge && data && typeof data.cart_total_items === "number") {
      badge.textContent = data.cart_total_items;
      badge.style.display = data.cart_total_items > 0 ? "inline-flex" : "none";
    }
  } catch (e) {
    console.error("refreshCartCount error:", e);
  }
}

document.addEventListener("DOMContentLoaded", refreshCartCount);
</script>    
</body>
</html>
