{% extends "base.html" %}
{% block content %}
{% set lang = lang %}

<h1 style="text-align:center; font-size:28px;">{{ "Корзина" if lang=="ru" else "Grozs" }}</h1>

{% if cart_items %}
<div style="display:flex; flex-direction:column; gap:15px;">
{% for item in cart_items %}
<div class="cart-item">
    <img src="{{ item.product.image }}">
    <div>
        <b style="font-size:20px;">{{ item.product["name_"+lang] }}</b>
        <p>{{ item.qty }} {{ lang=='ru'?'шт':'gab' }}</p>
        <p>{{ "%.2f"|format(item.product.price*item.qty) }} €</p>
    </div>
    <div class="qty-controls">
        <button onclick="changeQty({{ item.product.id }},'minus')">−</button>
        <button onclick="changeQty({{ item.product.id }},'plus')">+</button>
    </div>
</div>
{% endfor %}
</div>

<p style="font-size:20px;"><b>{{ "Итого" if lang=="ru" else "Kopā" }}:</b> {{ total }} €</p>

<div style="display:flex; gap:10px; justify-content:center; margin-top:20px;">
    <a href="/?lang={{ lang }}" class="buy-btn">{{ "На главную" if lang=="ru" else "Uz sākumlapu" }}</a>
    <a href="/catalog?lang={{ lang }}" class="buy-btn">{{ "В каталог" if lang=="ru" else "Uz katalogu" }}</a>
    <a href="/order?lang={{ lang }}" class="buy-btn">{{ "Оформить заказ" if lang=="ru" else "Pasūtīt" }}</a>
</div>

<script>
function changeQty(id, action) {
    fetch(`/api/update_cart/${id}/${action}`, { method:"POST" })
    .then(r=>r.json())
    .then(data=>{ location.reload(); });
}
</script>
{% else %}
<p style="text-align:center; font-size:18px;">{{ "Корзина пуста" if lang=="ru" else "Grozs ir tukšs" }}</p>
<a href="/catalog?lang={{ lang }}" class="buy-btn">{{ "В каталог" if lang=="ru" else "Uz katalogu" }}</a>
{% endif %}

{% endblock %}
