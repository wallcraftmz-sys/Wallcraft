<!DOCTYPE html>
<html lang="{{ lang }}">
<head>
    <meta charset="UTF-8">
    <title>Wallcraft</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/theme.css') }}">
    <script defer src="{{ url_for('static', filename='js/main.js') }}"></script>
    <link rel="icon" href="{{ url_for('static', filename='images/favicon.ico') }}">
<meta property="og:title" content="Wallcraft">
<meta property="og:description" content="ÐšÐ°Ñ‚Ð°Ð»Ð¾Ð³ Ð¸ Ð¾Ñ„Ð¾Ñ€Ð¼Ð»ÐµÐ½Ð¸Ðµ Ð·Ð°ÐºÐ°Ð·Ð¾Ð².">
<meta property="og:image" content="{{ url_for('static', filename='images/IMG_0857.jpeg', _external=True) }}">
<meta property="og:url" content="{{ request.url }}">
<meta name="twitter:card" content="summary_large_image">
</head>
<body>

<header class="top-header">
    <button class="menu-btn" onclick="toggleUserMenu()">â˜°</button>

    <div class="logo-center">
        <a href="{{ url_for('index') }}" class="logo-link">
            <span class="logo-text">Wallcraft</span>
        </a>
    </div>

    <div class="lang-switch">
        <a href="?lang=ru" class="{{ 'active' if lang == 'ru' }}">RU</a> |
        <a href="?lang=lv" class="{{ 'active' if lang == 'lv' }}">LV</a> |
        <a href="?lang=en" class="{{ 'active' if lang == 'en' }}">EN</a>
    </div>
</header>

<main class="container">
    {% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    <div class="flash-wrap">
      {% for category, msg in messages %}
        <div class="flash flash-{{ category }}">{{ msg }}</div>
      {% endfor %}
    </div>
  {% endif %}
{% endwith %}   
    {% if breadcrumbs and breadcrumbs|length > 1 %}
<nav class="breadcrumbs" aria-label="breadcrumb">
  {% for c in breadcrumbs %}
    {% if loop.last %}
      <span class="bc-current">{{ c.title }}</span>
    {% else %}
      <a class="bc-link" href="{{ c.url }}">{{ c.title }}</a>
      <span class="bc-sep">/</span>
    {% endif %}
  {% endfor %}
</nav>
{% endif %}
    {% block content %}{% endblock %}
</main>


<!-- FLOATING CART (User) -->
<a href="{{ url_for('cart') }}" class="cart-fab" aria-label="ÐšÐ¾Ñ€Ð·Ð¸Ð½Ð°">
  <span class="cart-fab-ico">ðŸ›’</span>
  <span id="cart-count" class="cart-badge">0</span>
</a>

<script>
async function refreshCartCount() {
  try {
    const res = await fetch("/api/cart_count", { credentials: "same-origin" });
    const ct = res.headers.get("content-type") || "";
    if (!ct.includes("application/json")) return;
    const data = await res.json();
    const badge = document.getElementById("cart-count");
    if (badge && data && typeof data.cart_total_items === "number") {
      badge.textContent = data.cart_total_items;
      badge.style.display = data.cart_total_items > 0 ? "inline-flex" : "none";
    }
  } catch (e) {
    console.error("refreshCartCount error:", e);
  }
}

document.addEventListener("DOMContentLoaded", refreshCartCount);
</script>    
</body>
</html>
