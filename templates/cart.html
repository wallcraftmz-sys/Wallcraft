{% extends "base.html" %}
{% block content %}
{% set lang = lang %}

<h1>{{ "Корзина" if lang=="ru" else "Grozs" }}</h1>

{% for item in cart_items %}
<div class="cart-item">
  <img src="{{ item.product.image }}" class="cart-item-image">
  <b>{{ item.product["name_"+lang] }}</b>
  {{ item.qty }} шт
  <div class="qty-controls">
    <button onclick="changeQty({{ item.product.id }},'minus')">−</button>
    <button onclick="changeQty({{ item.product.id }},'plus')">+</button>
  </div>
</div>
{% endfor %}

<p><b>Итого:</b> {{ total }} €</p>

<a href="/" class="buy-btn">На главную</a>
<a href="/catalog" class="buy-btn">В каталог</a>

<script>
function changeQty(id, action) {
    fetch(`/api/update_cart/${id}/${action}`, { method: "POST" })
        .then(r => r.json())
        .then(data => {
            if (data.qty === 0) {
                location.reload();
            } else {
                document.getElementById(`qty-${id}`).innerText = data.qty;
            }
        });
}
</script>
<div style="margin-top:20px; display:flex; gap:10px;">
    <a href="/?lang={{ lang }}" class="buy-btn">
        {{ "На главную" if lang=="ru" else "Uz sākumlapu" }}
    </a>
    <a href="/catalog?lang={{ lang }}" class="buy-btn">
        {{ "В каталог" if lang=="ru" else "Uz katalogu" }}
    </a>
</div>
{% endblock %}
