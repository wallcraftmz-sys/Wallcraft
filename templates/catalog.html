{% extends "base.html" %}
{% block content %}
<h1>Каталог товаров</h1>

<div class="product-grid">
    {% for product in products %}
    <div class="product-card">
        <img src="{{ product.image }}" alt="{{ product.name_ru }}">
        <h3>{{ product.name_ru }}</h3>
        <p>{{ product.description_ru }}</p>
        <p class="price">{{ product.price }} €</p>
        <button class="buy-btn" onclick="addToCart({{ product.id }})">В корзину</button>
    </div>
    {% endfor %}
</div>

<div id="popup" style="display:none; position:fixed; top:20%; right:20%; background:#fff; border:1px solid #ccc; padding:15px; z-index:999;">
    <span id="popup-text"></span>
    <button onclick="closePopup()">Закрыть</button>
</div>

<script>
function addToCart(id){
    fetch(`/api/add_to_cart/${id}`, {method:'POST'})
    .then(r=>r.json())
    .then(data=>{
        if(data.success){
            let p = data.product;
            document.getElementById('popup-text').innerHTML =
                `<img src="${p.image}" width="50"> ${p.name_ru} (${p.qty} шт.)<br>${p.price} €`;
            document.getElementById('popup').style.display='block';
        }
    });
}
function closePopup(){ document.getElementById('popup').style.display='none'; }
</script>
{% endblock %}
