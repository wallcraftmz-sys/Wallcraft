{% extends "base.html" %}
{% block content %}
{% set lang = lang %}

<h1 style="text-align:center; font-size:28px;">{{ "Оформление заказа" if lang=="ru" else "Pasūtījuma veikšana" }}</h1>

{% if cart_items %}
<div style="display:flex; flex-direction:column; gap:15px;">
{% for item in cart_items %}
<div class="cart-item">
    <img src="{{ item.product.image }}">
    <div>
        <b style="font-size:20px;">{{ item.product["name_"+lang] }}</b>
        <p>{{ item.qty }} {{ lang=='ru'?'шт':'gab' }}</p>
        <p>{{ "%.2f"|format(item.product.price*item.qty) }} €</p>
    </div>
    <div class="qty-controls">
        <button onclick="changeQty({{ item.product.id }},'minus')">−</button>
        <button onclick="changeQty({{ item.product.id }},'plus')">+</button>
    </div>
</div>
{% endfor %}
</div>

<p style="font-size:20px;"><b>{{ "Итого" if lang=="ru" else "Kopā" }}:</b> {{ total }} €</p>

<form method="POST" style="display:flex; flex-direction:column; gap:10px; max-width:400px; margin:auto;">
    <input type="text" name="name" placeholder="{{ 'Ваше имя' if lang=='ru' else 'Jūsu vārds' }}" required style="padding:10px; font-size:18px;">
    <input type="text" name="contact" placeholder="{{ 'Контакт' if lang=='ru' else 'Kontakti' }}" required style="padding:10px; font-size:18px;">
    <button type="submit" class="buy-btn">{{ 'Оформить заказ' if lang=='ru' else 'Veikt pasūtījumu' }}</button>
</form>

{% if success %}
<p style="text-align:center; font-size:18px; color:green; margin-top:15px;">{{ 'Заказ успешно оформлен!' if lang=='ru' else 'Pasūtījums veiksmīgi izveidots!' }}</p>
{% endif %}

{% else %}
<p style="text-align:center; font-size:18px;">{{ "Корзина пуста" if lang=='ru' else "Grozs ir tukšs" }}</p>
<a href="/catalog?lang={{ lang }}" class="buy-btn">{{ "В каталог" if lang=='ru' else "Uz katalogu" }}</a>
{% endif %}

<script>
function changeQty(id, action) {
    fetch(`/api/update_cart/${id}/${action}`, { method:"POST" })
    .then(r=>r.json())
    .then(data=>{ location.reload(); });
}
</script>
{% endblock %}
