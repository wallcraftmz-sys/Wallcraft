{% extends "base.html" %}
{% block content %}
{% set lang = lang %}

<div class="product-grid">
{% for p in products %}
<div class="product-card">
    <img src="{{ p.image }}">
    <h3>{{ p["name_" + lang] }}</h3>
    <p>{{ p["description_" + lang] }}</p>
    <p class="price">{{ p.price }} €</p>
    <button class="buy-btn" onclick="addToCart({{ p.id }})">
        {{ "В корзину" if lang=="ru" else "Grozā" }}
    </button>
</div>
{% endfor %}
</div>

<div id="popup" class="popup" onclick="this.style.display='none'">
  <div class="popup-content" onclick="event.stopPropagation()">
    <div id="popup-text"></div>
    <a href="/cart" class="buy-btn">OK</a>
  </div>
</div>

<script>
function addToCart(id){
 fetch(`/api/add_to_cart/${id}`,{method:'POST'})
 .then(r=>r.json())
 .then(d=>{
   document.getElementById("popup-text").innerHTML =
     `<b>${d.product.name_ru}</b><br>${d.qty} шт`;
   document.getElementById("popup").style.display="flex";
 });
}
</script>
{% endblock %}
