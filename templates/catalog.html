{% extends "base.html" %}
{% block content %}
<h1>Каталог товаров</h1>

<div class="product-grid">
    {% for product in products %}
    <div class="product-card">
        <img
    src="{{ url_for('static', filename=product.image) }}"
    alt="{{ product.name_ru }}"
>
        <h3>{{ product.name_ru }}</h3>
        <p>{{ product.description_ru }}</p>
        <p class="price">{{ product.price }} €</p>
        <button class="buy-btn" onclick="addToCart({{ product.id }})">
            В корзину
        </button>
    </div>
    {% endfor %}
</div>

<!-- POP-UP -->
<div id="popup" class="popup" onclick="closePopup()">
    <div class="popup-content" onclick="event.stopPropagation()">
        <div id="popup-text"></div>
        <div class="popup-actions">
            <a href="/catalog">Продолжить покупки</a>
            <a href="/cart">Перейти в корзину</a>
        </div>
    </div>
</div>

<script>
function addToCart(productId) {
    fetch(`/api/add_to_cart/${productId}`, { method: 'POST' })
        .then(res => res.json())
        .then(data => {
            if (data.success) {
                document.getElementById('popup-text').innerHTML = `
                    <img src="${data.product.image}" width="80"><br>
                    <strong>${data.product.name_ru}</strong><br>
                    ${data.product.qty} шт × ${data.product.price} €
                `;
                document.getElementById('popup').style.display = 'flex';
            }
        });
}

function closePopup() {
    document.getElementById('popup').style.display = 'none';
}
</script>
{% endblock %}
