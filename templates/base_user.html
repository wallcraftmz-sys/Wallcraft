<!DOCTYPE html>
<html lang="{{ lang }}">
<head>
  <meta charset="UTF-8">
  <title>Wallcraft</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  <!-- theme.css Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ¾ÑÑ‚Ğ°Ğ²Ğ¸Ñ‚ÑŒ, Ğ½Ğ¾ ĞµÑĞ»Ğ¸ Ñ‡Ñ‚Ğ¾-Ñ‚Ğ¾ Ğ»Ğ¾Ğ¼Ğ°ĞµÑ‚ÑÑ â€” Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ¾ ÑƒĞ±ĞµÑ€Ğ¸ -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/theme.css') }}">

  <script defer src="{{ url_for('static', filename='js/main.js') }}"></script>
  <link rel="icon" href="{{ url_for('static', filename='images/favicon.ico') }}">

  <meta property="og:title" content="Wallcraft">
  <meta property="og:description" content="ĞšĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³ Ğ¸ Ğ¾Ñ„Ğ¾Ñ€Ğ¼Ğ»ĞµĞ½Ğ¸Ğµ Ğ·Ğ°ĞºĞ°Ğ·Ğ¾Ğ².">
  <meta property="og:image" content="{{ url_for('static', filename='images/IMG_0857.jpeg', _external=True) }}">
  <meta property="og:url" content="{{ request.url }}">
  <meta name="twitter:card" content="summary_large_image">
</head>

<body>

<header class="top-header">
  <button class="menu-btn" type="button" onclick="wcMenuOpen()" aria-label="Menu">â˜°</button>

  <div class="logo-center">
    <a href="{{ url_for('index', lang=lang) }}" class="logo-link">
      <span class="logo-text">Wallcraft</span>
    </a>
  </div>

  <div class="lang-switch">
    <a href="?lang=ru" class="{{ 'active' if lang == 'ru' }}">RU</a> |
    <a href="?lang=lv" class="{{ 'active' if lang == 'lv' }}">LV</a> |
    <a href="?lang=en" class="{{ 'active' if lang == 'en' }}">EN</a>
  </div>
</header>

<!-- OVERLAY (Ğ²Ğ½Ğµ header!) -->
<div id="wcMenuOverlay" class="wc-overlay" onclick="wcMenuClose()"></div>

<!-- DRAWER (Ğ²Ğ½Ğµ header!) -->
<aside id="wcMenu" class="wc-drawer" aria-hidden="true">
  <div class="wc-drawer-head">
    <div class="wc-brand">
      <img class="wc-brand-logo" src="{{ url_for('static', filename='images/IMG_0857.jpeg') }}" alt="Wallcraft">
      <div class="wc-brand-title">Wallcraft</div>
    </div>
    <button class="wc-close" type="button" onclick="wcMenuClose()" aria-label="Close">âœ•</button>
  </div>

  <div class="wc-lang">
    <a href="?lang=lv" class="{{ 'active' if lang=='lv' }}">LV</a>
    <a href="?lang=ru" class="{{ 'active' if lang=='ru' }}">RU</a>
    <a href="?lang=en" class="{{ 'active' if lang=='en' }}">EN</a>
  </div>

  <nav class="wc-nav">
    <a class="wc-item" href="{{ url_for('catalog', cat='all', lang=lang) }}">
      <span class="wc-ico">ğŸ›ï¸</span>
      <span class="wc-text">ĞšĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³</span>
    </a>

    <div class="wc-sep"></div>

    {% for c in menu_categories %}
      <a class="wc-item" href="{{ url_for('catalog', cat=c.slug, lang=lang) }}">
        <span class="wc-ico">ğŸ“¦</span>
        <span class="wc-text">
          {% if lang == 'lv' %}{{ c.title_lv }}
          {% elif lang == 'en' %}{{ c.title_en }}
          {% else %}{{ c.title_ru }}{% endif %}
        </span>
      </a>
    {% endfor %}

    <div class="wc-sep"></div>

    <a class="wc-item" href="{{ url_for('cart', lang=lang) }}">
      <span class="wc-ico">ğŸ›’</span>
      <span class="wc-text">ĞšĞ¾Ñ€Ğ·Ğ¸Ğ½Ğ°</span>
      <span class="wc-badge">{{ cart_total_items }}</span>
    </a>

    {% if current_user.is_authenticated %}
      <a class="wc-item" href="{{ url_for('profile', lang=lang) }}">
        <span class="wc-ico">ğŸ‘¤</span>
        <span class="wc-text">ĞŸÑ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ</span>
      </a>
    {% else %}
      <a class="wc-item" href="{{ url_for('login', lang=lang) }}">
        <span class="wc-ico">ğŸ”‘</span>
        <span class="wc-text">Ğ’Ğ¾Ğ¹Ñ‚Ğ¸</span>
      </a>
    {% endif %}

    {% if current_user.is_authenticated and current_user.role == 'admin' %}
      <div class="wc-sep"></div>
      <div class="wc-section-title">Ğ‘Ñ‹ÑÑ‚Ñ€Ñ‹Ğµ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ</div>

      <a class="wc-card" href="{{ url_for('admin_categories', lang=lang) }}">
        <span class="wc-card-ico">ğŸ—‚ï¸</span>
        <span class="wc-card-text">ĞšĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¸</span>
      </a>

      <a class="wc-card" href="{{ url_for('admin_products', lang=lang) }}">
        <span class="wc-card-ico">â•</span>
        <span class="wc-card-text">Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ñ‚Ğ¾Ğ²Ğ°Ñ€</span>
      </a>

      <a class="wc-card" href="{{ url_for('admin_orders', lang=lang) }}">
        <span class="wc-card-ico">ğŸ§¾</span>
        <span class="wc-card-text">Ğ—Ğ°ĞºĞ°Ğ·Ñ‹</span>
      </a>

      <a class="wc-card" href="{{ url_for('admin_steps', lang=lang) }}">
        <span class="wc-card-ico">ğŸ“‹</span>
        <span class="wc-card-text">200 ÑˆĞ°Ğ³Ğ¾Ğ²</span>
      </a>
    {% endif %}

    <div class="wc-sep"></div>

    {% if current_user.is_authenticated %}
      <a class="wc-item wc-danger" href="{{ url_for('logout', lang=lang) }}">
        <span class="wc-ico">ğŸšª</span>
        <span class="wc-text">Ğ’Ñ‹Ğ¹Ñ‚Ğ¸</span>
      </a>
    {% endif %}
  </nav>
</aside>

<main class="container">
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      <div class="flash-wrap">
        {% for category, msg in messages %}
          <div class="flash flash-{{ category }}">{{ msg }}</div>
        {% endfor %}
      </div>
    {% endif %}
  {% endwith %}

  {% if breadcrumbs and breadcrumbs|length > 1 %}
    <nav class="breadcrumbs" aria-label="breadcrumb">
      {% for c in breadcrumbs %}
        {% if loop.last %}
          <span class="bc-current">{{ c.title }}</span>
        {% else %}
          <a class="bc-link" href="{{ c.url }}">{{ c.title }}</a>
          <span class="bc-sep">/</span>
        {% endif %}
      {% endfor %}
    </nav>
  {% endif %}

  {% block content %}{% endblock %}
</main>

<a href="{{ url_for('cart', lang=lang) }}" class="cart-fab" aria-label="ĞšĞ¾Ñ€Ğ·Ğ¸Ğ½Ğ°">
  <span class="cart-fab-ico">ğŸ›’</span>
  <span id="cart-count" class="cart-badge">0</span>
</a>

<script>
function wcMenuOpen(){
  const m = document.getElementById("wcMenu");
  const o = document.getElementById("wcMenuOverlay");
  if(!m || !o) return;
  m.classList.add("open");
  o.classList.add("show");
  m.setAttribute("aria-hidden","false");
}
function wcMenuClose(){
  const m = document.getElementById("wcMenu");
  const o = document.getElementById("wcMenuOverlay");
  if(!m || !o) return;
  m.classList.remove("open");
  o.classList.remove("show");
  m.setAttribute("aria-hidden","true");
}
document.addEventListener("keydown", (e)=>{
  if(e.key === "Escape") wcMenuClose();
});

async function refreshCartCount() {
  try {
    const res = await fetch("/api/cart_count", { credentials: "same-origin" });
    const ct = res.headers.get("content-type") || "";
    if (!ct.includes("application/json")) return;
    const data = await res.json();
    const badge = document.getElementById("cart-count");
    if (badge && data && typeof data.cart_total_items === "number") {
      badge.textContent = data.cart_total_items;
      badge.style.display = data.cart_total_items > 0 ? "inline-flex" : "none";
    }
  } catch (e) {}
}
document.addEventListener("DOMContentLoaded", refreshCartCount);
</script>

</body>
</html>
