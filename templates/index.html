{% extends "base.html" %}
{% block content %}
{% set lang = session.get('lang', 'ru') %}

<h1 style="text-align:center; font-size:28px; margin-bottom:20px;">
    {{ "Добро пожаловать в Wallcraft" if lang=="ru" else "Laipni lūdzam Wallcraft" }}
</h1>

<div class="product-grid">
    {% for product in products %}
    <div class="product-card">
        <img src="{{ url_for('static', filename=product.image) }}" alt="{{ product['name_' + lang] }}">
        <h3>{{ product["name_" + lang] }}</h3>
        <p style="min-height:50px;">{{ product["description_" + lang] }}</p>
        <p class="price"><b>{{ "%.2f"|format(product.price) }} €</b></p>
        <button class="buy-btn" onclick="addToCart({{ product.id }})">
            {{ "В корзину" if lang=="ru" else "Grozā" }}
        </button>
    </div>
    {% endfor %}
</div>

<!-- Попап добавления в корзину -->
<div id="popup" class="popup">
  <div class="popup-content">
      <div id="popup-text"></div>
      <div style="margin-top:12px;">
          <a href="/catalog?lang={{ lang }}" class="buy-btn">
              {{ "Продолжить покупки" if lang=="ru" else "Turpināt iepirkties" }}
          </a>
          <a href="/cart?lang={{ lang }}" class="buy-btn">
              {{ "Перейти в корзину" if lang=="ru" else "Pāriet uz grozu" }}
          </a>
      </div>
      <button onclick="closePopup()" style="margin-top:10px;">{{ "Закрыть" if lang=="ru" else "Aizvērt" }}</button>
  </div>
</div>

<script>
function addToCart(id){
    fetch(`/api/add_to_cart/${id}`, { method:'POST' })
    .then(res => res.json())
    .then(data => {
        if(data.success){
            document.getElementById("popup-text").innerHTML = `
                <b>${lang=='ru'?data.product.name_ru:data.product.name_lv}</b><br>
                ${data.cart_total_items} ${lang=='ru'?'шт':'gab'}`;
            document.getElementById("popup").style.display='flex';
            document.getElementById("cart-count").innerText = data.cart_total_items;
        }
    });
}

function closePopup(){
    document.getElementById("popup").style.display='none';
}
</script>
{% endblock %}
