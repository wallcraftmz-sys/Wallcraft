{% extends "base.html" %}
{% block content %}

<h1 style="text-align:center; margin-bottom:30px;">
    {{ "Добро пожаловать в Wallcraft" if lang=="ru" else "Laipni lūdzam Wallcraft" }}
</h1>

<div class="product-grid">
{% for product in products %}
    <div class="product-card">
        <img src="{{ url_for('static', filename=product.image) }}" 
             alt="{{ product.get('name_' + lang, product.get('name_ru')) }}">
        <h3>{{ product.get("name_" + lang, product.get("name_ru")) }}</h3>
        <p>{{ product.get("description_" + lang, product.get("description_ru")) }}</p>
        <p class="price">{{ product.price }} €</p>

        <button class="buy-btn" onclick="addToCart({{ product.id }})">
            {{ "В корзину" if lang=="ru" else "Ielikt grozā" }}
        </button>
    </div>
{% endfor %}
</div>

<div id="popup" class="popup" style="display:none;">
    <div class="popup-content">
        <div id="popup-text"></div>
        <button onclick="closePopup()">Закрыть</button>
    </div>
</div>

<script>
function addToCart(id){
    fetch(`/api/add_to_cart/${id}`, {method:'POST'})
    .then(res=>res.json())
    .then(data=>{
        if(data.success){
            let p = data.product;
            document.getElementById('popup-text').innerHTML =
                `<img src="${p.image}" width="50"> ${p.name_ru} (${p.qty} шт.)<br>${p.price} €`;
            document.getElementById('popup').style.display='flex';
        }
    });
}

function closePopup(){ document.getElementById('popup').style.display='none'; }
</script>

{% endblock %}
