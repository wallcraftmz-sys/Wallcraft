{% extends "admin/admin_base.html" %}
{% block content %}

<a href="{{ url_for('admin_orders') }}" class="admin-link">
    ← Назад к заказам
</a>

<h1 style="margin-top:15px">
    Заказ #{{ order.id }}
</h1>

<div class="admin-card">

    <p><strong>Покупатель:</strong><br>
        {{ order.name }}<br>
        <small>{{ order.contact }}</small>
    </p>

    <p><strong>Дата:</strong><br>
        {{ order.created_at.strftime("%d.%m.%Y %H:%M") }}
    </p>

    <p><strong>Состав заказа:</strong></p>
    <pre style="white-space:pre-line">{{ order.items }}</pre>

    <p><strong>Сумма:</strong>
        {{ order.total }} €
    </p>

    <hr>

    <p><strong>Текущий статус:</strong></p>

    <form method="post"
          action="{{ url_for('update_order_status', order_id=order.id) }}">
        <select name="status" onchange="this.form.submit()">
            {% for key, labels in ORDER_STATUSES.items() %}
                <option value="{{ key }}"
                        {% if order.status == key %}selected{% endif %}>
                    {{ labels[lang] }}
                </option>
            {% endfor %}
        </select>
    </form>

</div>

{% if history %}
<h3 style="margin-top:30px">История статусов</h3>

<div class="admin-card">
    {% for h in history %}
        <div style="font-size:14px; margin-bottom:6px;">
            {{ h.created_at.strftime("%d.%m.%Y %H:%M") }} —
            {{ ORDER_STATUSES[h.old_status][lang] }}
            →
            {{ ORDER_STATUSES[h.new_status][lang] }}
            <small>({{ h.changed_by }})</small>
        </div>
    {% endfor %}
</div>
{% endif %}

{% endblock %}
