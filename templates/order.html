{% extends "base.html" %}
{% block content %}
{% set lang = lang %}

<h1 style="text-align:center; font-size:28px; margin-bottom:20px;">
    {{ "Оформление заказа" if lang=="ru" else "Pasūtījuma veikšana" }}
</h1>

{% if cart_items %}
<div style="display:flex; flex-direction:column; gap:15px;">
{% for item in cart_items %}
<div class="cart-item" style="display:flex; flex-wrap:wrap; align-items:center; gap:10px; background:#fff; padding:10px; border-radius:8px;">
    <img src="{{ url_for('static', filename=item.product.image) }}" style="width:80px; height:80px; object-fit:cover; border-radius:6px;">
    <div style="flex:1;">
        <b style="font-size:20px;">{{ item.product["name_"+lang] }}</b>
        <p>{{ item.qty }} {{ lang=='ru'?'шт':'gab' }}</p>
        <p>{{ "%.2f"|format(item.product.price*item.qty) }} €</p>
    </div>
    <div class="qty-controls" style="display:flex; flex-direction:column; gap:5px;">
        <button onclick="changeQty({{ item.product.id }},'plus')" 
                style="font-size:22px; padding:6px 12px; border-radius:6px;">+</button>
        <button onclick="changeQty({{ item.product.id }},'minus')" 
                style="font-size:22px; padding:6px 12px; border-radius:6px;">−</button>
    </div>
</div>
{% endfor %}
</div>

<p style="font-size:20px; text-align:right; margin-top:15px;"><b>{{ "Итого" if lang=="ru" else "Kopā" }}:</b> {{ total }} €</p>

<form method="POST" style="display:flex; flex-direction:column; gap:12px; max-width:400px; margin:auto;">
    <input type="text" name="name" placeholder="{{ 'Ваше имя' if lang=='ru' else 'Jūsu vārds' }}" required style="padding:12px; font-size:16px; border-radius:6px; border:1px solid #ccc;">
    <input type="text" name="contact" placeholder="{{ 'Контакт' if lang=='ru' else 'Kontakti' }}" required style="padding:12px; font-size:16px; border-radius:6px; border:1px solid #ccc;">
    <button type="submit" class="buy-btn" style="padding:10px 15px; font-size:16px;">{{ 'Оформить заказ' if lang=='ru' else 'Veikt pasūtījumu' }}</button>
</form>

{% if success %}
<p style="text-align:center; font-size:18px; color:green; margin-top:15px;">{{ 'Заказ успешно оформлен!' if lang=='ru' else 'Pasūtījums veiksmīgi izveidots!' }}</p>
{% endif %}

<div style="display:flex; gap:10px; flex-wrap:wrap; justify-content:center; margin-top:20px;">
    <a href="/?lang={{ lang }}" class="buy-btn" style="padding:10px 15px; font-size:16px;">{{ "На главную" if lang=="ru" else "Uz sākumlapu" }}</a>
    <a href="/catalog?lang={{ lang }}" class="buy-btn" style="padding:10px 15px; font-size:16px;">{{ "В каталог" if lang=="ru" else "Uz katalogu" }}</a>
</div>

<script>
function changeQty(id, action) {
    fetch(`/api/update_cart/${id}/${action}`, { method:"POST" })
    .then(r=>r.json())
    .then(data=>{ location.reload(); });
}
</script>

{% else %}
<p style="text-align:center; font-size:18px;">{{ "Корзина пуста" if lang=="ru" else "Grozs ir tukšs" }}</p>
<a href="/catalog?lang={{ lang }}" class="buy-btn" style="padding:10px 15px; font-size:16px;">{{ "В каталог" if lang=='ru' else "Uz katalogu" }}</a>
{% endif %}

{% endblock %}
