{% extends "base.html" %}
{% block content %}
<h1>Каталог товаров</h1>

<form method="GET" style="margin-bottom:20px;">
    <select name="cat">
        <option value="">Все категории</option>
        <option value="walls">Обои</option>
        <option value="tools">Инструменты</option>
    </select>

    <input type="number" name="min_price" placeholder="Мин. цена">
    <input type="number" name="max_price" placeholder="Макс. цена">

    <button type="submit" class="buy-btn">Фильтровать</button>
</form>

<div class="product-grid">
    {% for product in products %}
    <div class="product-card">

        <img
    src="{{ url_for('static', filename=product.image) }}"
    alt="{{ product.name_ru }}"
    class="product-image"
/>

        <h3>{{ product.name_ru }}</h3>
        <p>{{ product.description_ru }}</p>
        <p class="price">{{ product.price }} €</p>

        <button class="buy-btn" onclick="addToCart({{ product.id }})">
            В корзину
        </button>

    </div>
    {% endfor %}
</div>

<!-- Поп-ап -->
<div id="popup" class="popup" onclick="closePopup()">
    <div class="popup-content" onclick="event.stopPropagation()">
        <div id="popup-text"></div>
        <div class="popup-actions">
            <a href="/catalog" class="btn-small">Продолжить покупки</a>
            <a href="/cart" class="btn-small">Перейти в корзину</a>
        </div>
    </div>
</div>

<script>
function addToCart(productId) {
    fetch(`/api/add_to_cart/${productId}`, { method: 'POST' })
        .then(res => res.json())
        .then(data => {
            if (data.success) {
                document.getElementById('popup-text').innerHTML = `
                    <img src="${data.product.image_url}" width="80"><br>
                    <strong>${data.product.name_ru}</strong><br>
                    ${data.qty} шт × ${data.product.price} €
                `;
                document.getElementById('popup').style.display = 'flex';
            }
        });
}

function closePopup() {
    document.getElementById('popup').style.display = 'none';
}
</script>

{% endblock %}
